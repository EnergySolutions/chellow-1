<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css"
      href="{{context_path}}/reports/19/output/">
    <title>Chellow &gt; Scenario Runner</title>
  </head>
  <body>
    <p>
      <a href="{{context_path}}/reports/1/output/">Chellow</a> &gt;
      Scenario Runner
    </p>

    {% if messages %}
      <ul>
        {% for message in messages %}
          <li>{{ message }}</li>
        {% endfor %}
      </ul>
    {% endif %}

    <table><caption>Scenarios</caption>
      <thead>
        <tr>
          <th>Scenario</th>
          <th>View</th>
          <th>Edit</th>
          <th>scenario_start</th>
          <th>scenario_duration</th>
        </tr>
      </thead>
      <tbody>
        {% for scenario in scenarios %}
          {% set props = scenario.make_properties() %}
          <tr>
            <td>{{scenario.name}}</td>
            <td>
              <a href="{{context_path}}/reports/77/output/?supplier_contract_id={{scenario.id}}#properties">
                View
              </a>
            </td>
            <td>
              [<a href="{{context_path}}/reports/317/output/?supplier_contract_id={{scenario.id}}#properties">edit</a>]
            </td>
            <td>{{props.scenario_start}}</td>
            <td>{{props.scenario_duration}}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <br>
    <form action="{{context_path}}/reports/247/output/">
      <fieldset>
        <legend>Run Scenario</legend>
        <select name="scenario">
          {% for scenario in scenarios %}
            {{input_option('scenario', scenario.name, scenario.name)}}
          {% endfor %}
        </select>
        <input type="submit" value="Run">
      </fieldset>
    </form>

    <h4>Rates</h4>

    <table><caption>Pass-through Contract Rates</caption>
      <thead>
        <tr>
          <th rowspan="2">Contract</th>
          <th colspan="2">Last Rate Script</th>
        </tr>
        <tr>
          <th>Start Date</th>
          <th>Finish Date</th>
        </tr>
      </thead>
      <tbody>
        {% for contract in contracts %}
          <tr>
            <td>
              <a href="{{context_path}}/reports/267/output/?non_core_contract_id={{contract.id}}">
                {{contract.name}}
              </a>
            </td>
            <td>{{contract.finish_rate_script.start_date|hh_format}}</td>
            <td>{{contract.finish_rate_script.finish_date|hh_format}}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <p>
      Consider a half-hour H, and a contract with rate scripts. The rate at H
     is determined by:
    </p>

    <dl>
      <dt>base_date</dt>
      <dd>A date, None means end of last rate script</dd>
      <dt>multiplier</dt>
      <dd>A number</dd>
      <dt>constant</dt>
      <dd>A number</dd>
    </dl>

    <p>
      If base_date is None, then it is set to the end date of the latest rate
      script. If H <= base date, then the rate script at H is used without any
      change. If H > base_date, then the rate script at base_date is used to
      obtain the value of the rate at H by doing (rate_at_base_date *
      multiplier + constant).
    </p>

		<h3>Template Scenario Properties</h3>

		<pre>
{
    'bsuos' : {
		    'base_date': datetime(2011, 1, 1),
        'multiplier': 1,
        'constant': 0,
    },

    'ccl': {
        'base_date': datetime(2014, 10, 1),
        'multiplier': 1,
        'constant': 0,
    },

    'aahedc': {
        'base_date': None,
        'multiplier': 0,
        'constant': 0.00091361,
    },

    'scenario_start': datetime(2011, 1, 1),  # Date or None for this month
    'scenario_duration': 1,  # Number of months
    'resolution': 'hh',  # 'hh' or 'month'
															    
    'kw_changes':
		# CSV format with the following columns
    # Site Code, Type ('used' or 'generated') , Date (yyyy-mm-dd), Multiplier
    """
		CI005, used, 2011-01-01, 0.5
		CI005, generated, 2011-01-01, 2
    """,
}</pre>
  </body>
</html>
