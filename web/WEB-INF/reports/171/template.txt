<?xml version="1.0" encoding="us-ascii"?>
<xsl:stylesheet version="1.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <xsl:output method="xml" encoding="US-ASCII"
        doctype-public="-//W3C//DTD XHTML 1.1//EN"
        doctype-system="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"
        indent="yes" />
    <xsl:template match="/">
        <html>
            <head>
                <link rel="stylesheet" type="text/css"
                    href="{/source/request/@context-path}/reports/19/output/" />

                <title>Chellow &gt; System</title>
            </head>
            <body>
                <p>
                    <a
                        href="{/source/request/@context-path}/reports/1/output/">
                        <xsl:value-of select="'Chellow'" />
                    </a>
                    &gt;
                    <xsl:value-of select="'System'" />
                </p>
                  <xsl:if test="//message">
                    <ul>
                        <xsl:for-each select="//message">
                            <li>
                                <xsl:value-of select="@description" />
                            </li>
                        </xsl:for-each>
                    </ul>
                </xsl:if>
<p><a href=".">Refresh</a></p>
<p>Chellow Version
                    <a href="https://bitbucket.org/ww_tlocke/chellow/commits/{/source/@chellow-version}" ><xsl:value-of select="/source/@chellow-version" /></a></p>
                <table style="text-align: right">
                    <caption>JVM memory (bytes)</caption>
                    <tr>
                        <th>Max</th>
                        <td>
                            <xsl:value-of select="/source/@max-memory" />
                        </td>
                    </tr>
                    <tr>
                        <th>Total</th>
                        <td>
                            <xsl:value-of
                                select="/source/@total-memory" />
                        </td>
                    </tr>
                    <tr>
                        <th>Free</th>
                        <td>
                            <xsl:value-of select="/source/@free-memory" />
                        </td>
                    </tr>
                </table>
                <br/>
                <table>
                <tr>
                  <td>Available Processors</td>
                  <td><xsl:value-of select="/source/@available-processors"/></td>
                </tr>
                <tr>
                  <td>System Load Average</td>
                  <td><xsl:value-of select="/source/@system-load-average"/></td>
                </tr>
                </table>
<br/>
    <table><caption>JavaSysMon</caption>
      <tr>
          <td>CPU Frequency (Hz)</td>
          <td><xsl:value-of select="/source/@cpu-frequency-in-hz"/></td>
      </tr>
      <tr>
          <td>Current PID</td>
          <td><xsl:value-of select="/source/@current-pid"/></td>
      </tr>
      <tr>
          <td>Number Of CPU cores</td>
          <td><xsl:value-of select="/source/@num-cpus"/></td>
      </tr>
      <tr>
          <td>OS Name</td>
          <td><xsl:value-of select="/source/@os-name"/></td>
      </tr>
      <tr>
          <td>Uptime (s)</td>
          <td><xsl:value-of select="/source/@uptime-in-seconds"/></td>
      </tr>
      <tr>
          <td>Idle ms</td>
          <td><xsl:value-of select="/source/@idle-millis"/></td>
      </tr>
      <tr>
          <td>System ms</td>
          <td><xsl:value-of select="/source/@system-millis"/></td>
      </tr>
      <tr>
          <td>Total ms</td>
          <td><xsl:value-of select="/source/@total-millis"/></td>
      </tr>
      <tr>
          <td>User ms</td>
          <td><xsl:value-of select="/source/@user-millis"/></td>
      </tr>
    </table>

<br/>

<table><caption>All Live Threads</caption>
<tr><th>Id</th><th>Name</th><th>Interrupted?</th><th>Status</th><th>Request</th><th>Stack Trace</th>
</tr>
<xsl:for-each select="/source/thread">
<tr>
   <td><xsl:value-of select="@id"/></td>
   <td><xsl:value-of select="@name"/></td>
   <td><xsl:value-of select="@is-interrupted"/>
       <xsl:if test="@is-interrupted='False'">
       <form method="post" action=".">
           <input type="hidden" name="thread-id" value="{@id}" />
           <input type="submit" name="interrupt" value="Interrupt" />
       </form> 
       </xsl:if>
   </td>
   <td><xsl:value-of select="@status"/></td>
   <td><xsl:value-of select="@request"/></td>
   <td><pre><xsl:value-of select="."/></pre></td>
</tr>
</xsl:for-each>
</table>

<h4>Java System Properties</h4>

<pre><xsl:value-of select="/source/properties"/></pre>

<h4>DBMS Properties</h4>

<table>
<tr><th>Product Name</th><td><xsl:value-of select="/source/@db-product-name" /></td></tr>
<tr><th>Product Version</th><td><xsl:value-of select="/source/@db-product-version"/></td></tr>
<tr><th>Driver Name</th><td><xsl:value-of select="/source/@db-driver-name"/></td></tr>
<tr><th>Driver Version</th><td><xsl:value-of select="/source/@db-driver-version"/></td></tr>
<tr><th>Transaction Isolation (of current connection)</th><td><xsl:value-of select="/source/@transaction-isolation"/></td></tr>
  <xsl:for-each select="/source/pg-settings/setting">
    <tr>
      <th><xsl:value-of select="@name"/></th>
      <td><xsl:value-of select="@value"/></td>
    </tr>
  </xsl:for-each>
</table>

<h4>PostgreSQL Current Activity</h4>

<table>
    <thead>
        <tr>
            <th>Cancel</th>
            <xsl:for-each select="/source/pg-stat-activity/column">
                <th><xsl:value-of select="@name"/></th>
            </xsl:for-each>
        </tr>
    </thead>
    <tbody>
        <xsl:for-each select="/source/pg-stat-activity/row">
            <tr>
                <td>
                  <form action="." method="post">
                    <fieldset>
                      <input type="hidden" name="backend_pid" value="{cell[3]/@value}" />
                      <input type="submit" name="cancel_backend" value="Cancel" />
                    </fieldset>
                  </form>
                </td>
                <xsl:for-each select="cell">
                    <td><xsl:value-of select="@value"/></td>
                </xsl:for-each>
            </tr>
        </xsl:for-each>
    </tbody>
</table>

<h4>PostgreSQL pg_stat_all_tables</h4>

<table>
    <thead>
        <tr>
            <xsl:for-each select="/source/pg-stat-all-tables/column">
                <th><xsl:value-of select="@name"/></th>
            </xsl:for-each>
        </tr>
    </thead>
    <tbody>
        <xsl:for-each select="/source/pg-stat-all-tables/row">
            <tr>
                <xsl:for-each select="cell">
                    <td><xsl:value-of select="@value"/></td>
                </xsl:for-each>
            </tr>
        </xsl:for-each>
    </tbody>
</table>

<h4>PostgreSQL indexes</h4>

<table>
    <thead>
        <tr>
            <xsl:for-each select="/source/pg-indexes/column">
                <th><xsl:value-of select="@name"/></th>
            </xsl:for-each>
        </tr>
    </thead>
    <tbody>
        <xsl:for-each select="/source/pg-indexes/row">
            <tr>
                <xsl:for-each select="cell">
                    <td><xsl:value-of select="@value"/></td>
                </xsl:for-each>
            </tr>
        </xsl:for-each>
    </tbody>
</table>

<br/>

<table>
  <caption>Python Libraries</caption>
  <thead>
    <th>Library</th>
    <th>Version</th>
  </thead>
  <tbody>
    <xsl:for-each select="/source/py-libs/py-lib">
      <tr>
        <td><xsl:value-of select="@name"/></td>
        <td><xsl:value-of select="@version"/></td>
      </tr>
    </xsl:for-each>
  </tbody>
</table>

<br/>

<form method="post" action="{/source/request/@context-path}/reports/171/output/">
  <fieldset>
      <legend>Run shutdown script</legend>
      <input type="submit" name="run_shutdown" value="Run"/>
  </fieldset>
</form>
<form method="post" action="{/source/request/@context-path}/reports/171/output/">
  <fieldset>
      <legend>Run startup script</legend>
      <input type="submit" name="run_startup" value="Run" />
  </fieldset>
</form>

<ul>
<li><a href="{/source/request/@context-path}/reports/375/output/">Clogs</a></li>
          <li><a href="{/source/request/@context-path}/reports/103/output/">Libraries</a></li>
        </ul>      
      </body>
    </html>
  </xsl:template>
</xsl:stylesheet>