<!doctype html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="{{ context_path }}/reports/19/output/" />
    <title>Chellow &gt; Users &gt; {{ user.email_address }}</title>
  </head>
  <body>
    <p>
      <a href="{{ context_path }}/">Chellow</a> &gt; <a href="{{ context_path }}/reports/255/output/">Users</a> &gt;
      {{ user.email_address }}
    </p>

    {% if messages %}
      <ul>
        {% for message in messages %}
          <li>{{ message }}</li>
        {% endfor %}
      </ul>
    {% endif %}

    {% if request.getParameter('delete') %}
      <form method="post" action=".">
        <fieldset>
          <input type="hidden" name="user_id" value="{{user.id}}">
          <legend>
            Do you really want to delete the user '{{ user.email_address }}'?
          </legend>
          <input type="submit" name="delete" value="Delete">
          <p><a href=".">Cancel</a></p>
        </fieldset>
      </form>
    {% else %}
      <form method="post" action=".">
        <fieldset>
          <input type="hidden" name="user_id" value="{{ user.id }}"/>
          <legend>Update details</legend>
          <br />
          <label>
            Email Address
            <input name="email_address" size="100" value="
              {%- if request.getParameter('email_address') -%}
                {{ request.getParameter('email_address') }}
              {%- else -%}
                {{ user.email_address }}
              {%- endif -%}
            ">
          </label>
          <br />
          <br />
          <fieldset>
            <legend>Role</legend>
            <label>
              <input type="radio" name="user_role_id" value="1"
                {%- if request.getParameter('user_role_id') -%}
                  {%- if request.getParameter('user_role_id') == '1' %}
                    checked
                  {%- endif -%}
                {%- else -%}
                  {%- if user.user_role.id == 1 %}
                    checked
                  {%- endif -%}
                {%- endif -%}
              >
              Editor
            </label>
            <br />
            <label>
              <input type="radio" name="user_role_id" value="3"
                {% if request.getParameter('user_role_id') %}
                  {% if request.getParameter('user_role_id') == '3' %}
                    checked
                  {% endif %}
                {% else %}
                  {% if user.user_role.id == 3 %}
                    checked
                  {% endif %}
                {% endif %}
              >
              Viewer
            </label>
            <br />
            <label>
              <input type="radio" name="user_role_id" value="2"
                {%- if request.getParameter('user_role_id') -%}
                  {%- if request.getParameter('user_role_id') == '2' -%}
                    checked
                  {%- endif -%}
                {%- else -%}
                  {%- if user.user_role.id == 2 -%}
                    checked
                  {% endif %}
                {% endif %}
              >
              Party Viewer
            </label>
            <select name="party_id">
              {% for party in parties %}
                <option value="{{ party.id }}"
                  {%- if request.getParameter('party_id') -%}
                    {%- if request.getParameter('party_id') == party.id %}
                      selected
                    {%- endif -%}
                  {%- else -%}
                    {%- if user.party.id == party.id %}
                      selected
                    {%- endif -%}
                  {%- endif -%}
                >
                  {{ party.name }} {{ party.participant.code }}
                  {{ party.market_role.description }}
                </option>
              {% endfor %}
            </select>
          </fieldset>
          <br />
          <br />
          <input type="submit" value="Update" />
          <input type="reset" value="Reset" />
        </fieldset>
      </form>
      <br />
      <br />
      <form method="post" action=".">
        <fieldset>
          <input type="hidden" name="user_id" value="{{ user.id }}"/>
          <legend>Change password</legend>
          <br />
          <label>
            Current password
            <input type="password" name="current_password" />
          </label>
          <br />
          <br />
          <label>
            New password
            <input type="password" name="new_password" />
          </label>
          <br />
          <label>
            Confirm new Password
            <input type="password" name="confirm_new_password" />
          </label>
          <br />
          <br />
          <input type="submit" value="Change" />
          <input type="reset" value="Reset" />
        </fieldset>
      </form>
      <br />
      <form action=".">
        <fieldset>
          <input type="hidden" name="user_id" value="{{user.id}}">
          <legend>Delete this user</legend>
          <input type="submit" name="delete" value="Delete">
        </fieldset>
      </form>
    {% endif %}
  </body>
</html>